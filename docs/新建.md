## 1.3 编写 Spring 应用程序

对于大部分 Web 程序，主要有如下三个部件：

1. 一个用于处理网页请求的控制器类；
2. 一个视图模板，用于定义网页外观；
3. 一个测试类，用于测试网页功能；

### 处理 Web 请求

Spring 附带了强大的 Spring MVC 框架，其核心概念是 **控制器，一个处理请求并使用某种信息进行响应的类**，对于面向浏览器的应用程序，控制器的响应方式是可选地填充模型数据并将其传递给视图，从而返回给浏览器的 HTML。

```java
package tacos.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

/**
 * Created with IntelliJ IDEA.
 * Version : 1.0
 * Author  : 村雨遥
 * Email   : cunyu1024@foxmail.com
 * Website : https://cunyu1943.github.io
 * 公众号   ：村雨遥
 * Date    : 2020/5/24 下午3:46
 * Project : taco-cloud
 * Package : tacos.controller
 * Class   : HomeController
 * Desc    : 主页控制器
 */

@Controller
public class HomeController {
    @GetMapping("/")
    public String home() {
        return "home";
    }
}
```

该类用 `@Controller` 注解，会自动将该类识别为组件扫描的组件。Spring 的组件扫描会自动发现它，并在 Spring 应用程序上下文中创建一个 `HomeController` 实例作为 Bean。

### 定义视图

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Taco Cloud</title>
</head>
<body>
    <h1>Welcome to ...</h1>
</body>
</html>
```

### 测试控制器

对 HTML 页面内容进行断言测试时比较麻烦，为此 Spring 提供了强大的测试支持。

```java
package tacos.controller;

import static org.hamcrest.Matchers.containsString;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.view;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.test.web.servlet.MockMvc;

/**
 * Created with IntelliJ IDEA.
 * Version : 1.0
 * Author  : cunyu
 * Email   : cunyu1024@foxmail.com
 * Website : https://cunyu1943.github.io
 * 公众号   ：村雨遥
 * Date    : 2020/5/30 下午4:19
 * Project : taco-cloud
 * Package : tacos.controller
 * Class   : HomeControllerTest
 * Desc    : 测试控制器
 */

@RunWith(SpringRunner.class)
@WebMvcTest(HomeController.class)
public class HomeControllerTest {
    @Autowired
    private MockMvc mockMvc;

    @Test
    public void testHomePage() throws Exception{
        mockMvc.perform(get("/")).andExpect(status().isOk())
        .andExpect(view().name("home"))
        .andExpect(content().string(containsString("Welcome to ...")));
    }
}

```

`@WebMvcTest` 注解是 Spring Boot 提供的一些特殊测试注释，将测试安排在 Spring MVC 应用程序的上下文中运行。此外还为测试 Spring MVC 提供了 Spring 支持。

### 了解 Spring Boot DevTools

DevTools 为 Spring 开发人员主要提供了以下的一些同步工具：

1. 代码更改时自动重启应用程序。
2. 当以浏览器为目标的资源（如模板、JavaScript、样式表等）发生变化时，浏览器自动刷新。
3. 自动禁用模板缓存。
4. 若 H2数据库正在使用，则在 H2 控制台中构建。